#!/bin/bash

set -e

envs=$(grep 'my[A-Za-z0-9]* = with pkgs' $HOME/.config/nixpkgs/config.nix | sed 's/^\s*\(my[A-Za-z0-9]*\) = with.*$/\1/' | xargs)
readarray -td" " arrenvs <<<"$envs"; declare arrenvs;

for i in "${!arrenvs[@]}"; do
    if [ $i -gt 1 ]; then
        prettyname="${arrenvs[$i]}"
        prettyname=$(echo $prettyname | sed 's/^my\(.*\)$/\l\1/')
	echo "$(($i-1)): $prettyname"
    fi
done

read -p "> " input
input=$(($input+1))
if [[ $input ]] && [ $input -eq $input 2>/dev/null ]; then
    name="${arrenvs[$input]}"
    prettyname=$(echo $name | sed 's/^my\(.*\)$/\l\1/')
    NIX_ENV="$prettyname" nix-shell --command zsh -p $name
fi

