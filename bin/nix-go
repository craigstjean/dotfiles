#!/bin/bash

set -e

envs=$(grep 'my[A-Za-z0-9]* = with pkgs' $HOME/.config/nixpkgs/config.nix | sed 's/^ *\(my[A-Za-z0-9]*\) = with.*$/\1/' | xargs)
echo $envs
IFS=" " read -r -a arrenvs <<<"$envs"

for i in "${!arrenvs[@]}"; do
    if [ $i -gt 2 ]; then
        prettyname="${arrenvs[$i]}"
        prettyname=$(echo $prettyname | sed 's/^my\(.*\)$/\1/' | tr '[:upper:]' '[:lower:]')
	echo "$(($i-2)): $prettyname"
    fi
done

read -p "> " input
input=$(($input+2))
if [[ $input ]] && [ $input -eq $input 2>/dev/null ]; then
    name="${arrenvs[$input]}"
    prettyname=$(echo $name | sed 's/^my\(.*\)$/\1/' | tr '[:upper:]' '[:lower:]')
    NIX_ENV="$prettyname" nix-shell --command zsh -p $name
fi

